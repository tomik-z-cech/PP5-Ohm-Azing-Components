{% extends "base.html" %}
{% load allauth i18n socialaccount %}
{% load static %}

{% block nav_name %}Register{% endblock %}

{% block content %}
<div class="container wrapper d-flex justify-content-center align-items-center">
    <div class="form-background add-shadow">
        <div class="w-100 d-flex justify-content-end">
            <a href="{% url 'home' %}" aria-label="Close" class="close-form">
                <i class="bi bi-x"></i>
            </a>
        </div>
        <div class="w-100 d-flex justify-content-center p-3">
            <h1>
                Register
            </h1>
        </div>
        <div class="w-100 d-flex justify-content-center form-heading">
            <p>Already have an account? Then please <a href="{{ login_url }}"> log in </a>.</p>
        </div>
        <div class="w-100 d-flex justify-content-center form-heading">
            <p>Please read our <a href="#" data-bs-toggle="modal" data-bs-target="#termsModal"> Terms & Conditions </a>.</p>
        </div>
        {% url 'account_signup' as action_url %}
        {% element form form=form method="post" action=action_url tags="entrance,signup" %}
        {% slot body %}
            {% csrf_token %}
            {% element fields form=form unlabeled=True %}
            {% endelement %}
            {% if redirect_field_value %}
                <input type="hidden" name="{{ redirect_field_name }}" value="{{ redirect_field_value }}" />
            {% endif %}
        {% endslot %}
        {% slot actions %}
            <div class="w-100 d-flex justify-content-center p-3">
                <button tags="prominent,signup" type="submit" class="custom-button button-shadow" id="registerSubmit">
                    Register
                </button>
            </div>
        {% endslot %}
        {% endelement %}
        {% include "socialaccount/snippets/login.html" with page_layout="entrance" %}
    </div>
</div>
<!-- T&C Modal -->
<div class="modal fade" id="termsModal" tabindex="-1" aria-labelledby="termsModalLabel" aria-hidden="true">
    <div class="modal-dialog w-75">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="termsModalLabel">Terms & Conditions</h2>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <ul>
                    <li>
                        <p><strong>1. User Agreement:</strong> By registering and using our website, you agree to abide by these terms and conditions.</p>
                    </li>
                    <li>
                        <p><strong>2. Account Responsibility:</strong> Users are responsible for maintaining the confidentiality of their account information, including username and password. Any activity that occurs under the user's account is their responsibility.</p>
                    </li>
                    <li>
                        <p><strong>3. Prohibited Content:</strong> Users agree not to upload, post, or share any content that is offensive, inappropriate, or violates the intellectual property rights of others. This includes but is not limited to images, text, or any other form of media.</p>
                    </li>
                    <li>
                        <p><strong>4. Product Purchase:</strong> Users agree to adhere to the terms of purchasing products on the website, including payment, shipping, and return policies.</p>
                    </li>
                    <li>
                        <p><strong>5. User Conduct:</strong> Users agree to conduct themselves in a respectful manner when interacting with other users, administrators, or any other individuals associated with the website.</p>
                    </li>
                    <li>
                        <p><strong>6. Intellectual Property:</strong> All content provided on the website, including images, text, and other media, is the intellectual property of the website owner. Users may not reproduce, distribute, or use this content without explicit permission.</p>
                    </li>
                    <li>
                        <p><strong>7. Data Privacy:</strong> The website collects and stores user data in accordance with the privacy policy. By using the website, users consent to the collection, storage, and use of their personal information as outlined in the privacy policy.</p>
                    </li>
                    <li>
                        <p><strong>8. Payment by Card:</strong> Users may only make payments by card if they are the card owner or have explicit permission from the card owner to use it for transactions on our platform.</p>
                    </li>
                    <li>
                        <p><strong>9. Termination of Account:</strong> The website reserves the right to terminate or suspend user accounts for any violation of these terms and conditions or for any other reason deemed necessary by the website administrator.</p>
                    </li>
                    <li>
                        <p><strong>10. Changes to Terms:</strong> The website reserves the right to modify or update these terms and conditions at any time. Users will be notified of any changes, and continued use of the website implies acceptance of the updated terms.</p>
                    </li>
                </ul>
            </div>
            <div class="modal-footer">
                <button type="button" class="custom-button button-shadow" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
{% endblock content %}

{% block extra_js %}
    {{ block.super }}
    <script>
        // Common Passwords to compare
        let tooCommonPass = [
            "password",
            "123456",
            "123456789",
            "qwerty",
            "abc123",
            "111111",
            "123123",
            "admin",
            "letmein",
            "welcome",
            "monkey",
            "1234",
            "12345",
            "1234567",
            "12345678",
            "1234567890",
            "password1",
            "123",
            "1234",
            "12345",
            "123456",
            "1234567",
            "12345678",
            "123456789",
            "1234567890",
            "qwertyuiop",
            "asdfghjkl",
            "zxcvbnm",
            "123qwe",
            "123abc"
        ];

        // Checkers of 4 password conditions
        let passOK1 = false;
        let passOK2 = false;
        let passOK3 = false;
        let passOK4 = false;

        $(document).ready(function () {
            // Initially hide register button
            $("#registerSubmit").hide();
            // If any registration fields change
            $("#id_password1, #id_email, #id_email2, #id_username").on("input", function() {
                // If pasword empty change color to white of all conditions
                if ($("#id_password1").val().length < 1){
                    $("#registerSubmit").hide();
                    $(".form-background ul li:nth-child(1)").css("color", "var(--white)");
                    $(".form-background ul li:nth-child(2)").css("color", "var(--white)");
                    $(".form-background ul li:nth-child(3)").css("color", "var(--white)");
                    $(".form-background ul li:nth-child(4)").css("color", "var(--white)");
                } else {
                    // If password longer then 8 characters
                    if ($("#id_password1").val().length > 8) {
                        // Highlight condition passed and set checker
                        $(".form-background ul li:nth-child(2)").css("color", "var(--light-gold)");
                        passOK1 = true;
                    } else {
                        // Make condition not highlighted and unset checker
                        $(".form-background ul li:nth-child(2)").css("color", "var(--white)");
                        passOK1 = false;
                    };
                    // If password contains at least one letter
                    if (/[a-zA-Z]/.test($("#id_password1").val())) {
                        // Highlight condition passed and set checker
                        $(".form-background ul li:nth-child(4)").css("color", "var(--light-gold)");
                        passOK2 = true;
                    } else {
                        // Make condition not highlighted and unset checker
                        $(".form-background ul li:nth-child(4)").css("color", "var(--white)");
                        passOK2 = false;
                    };
                    // If username not included in password
                    if ($("#id_password1").val().toLowerCase().includes($("#id_username").val().toLowerCase()) && $("#id_username").val().length > 0 ) {
                        // Make condition not highlighted and unset checker
                        $(".form-background ul li:nth-child(1)").css("color", "var(--white)");
                        passOK3 = false;
                    } else {
                        // Highlight condition passed and set checker
                        $(".form-background ul li:nth-child(1)").css("color", "var(--light-gold)");
                        passOK3 = true;
                    };
                    // If passsword not included in common passwords above
                    if (tooCommonPass.includes($("#id_password1").val().toLowerCase())) {
                        // Make condition not highlighted and unset checker
                        $(".form-background ul li:nth-child(3)").css("color", "var(--white)");
                        passOK4 = false;
                    } else {
                        // Highlight condition passed and set checker
                        $(".form-background ul li:nth-child(3)").css("color", "var(--light-gold)");
                        passOK4 = true;
                    };
                };
                // All 4 conditions are true and other fields are not empty
                if (passOK1 == true && passOK1 == true && passOK1 == true && passOK1 == true && $("#id_username").val().length > 0 && $("#id_email").val().length > 0 && $("#id_email2").val().length > 0){
                    // Show register buttton
                    $("#registerSubmit").show();
                } else {
                    // Hide regisater button
                    $("#registerSubmit").hide();
                };
            });
        });
    </script>
{% endblock %}